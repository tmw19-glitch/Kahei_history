import React, { useState, useEffect, useRef } from 'react';
import { RefreshCw, Coins, ShoppingBag, Info, ArrowRight, History, TrendingUp, TrendingDown, BookOpen, AlertTriangle } from 'lucide-react';

const App = () => {
  const [currentYen, setCurrentYen] = useState(10000);
  const [selectedEra, setSelectedEra] = useState('edo_early');
  const [region, setRegion] = useState('edo');
  const [showEventToast, setShowEventToast] = useState(false);
  
  // æ™‚ä»£ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆè©³ç´°ç‰ˆï¼‰
  const eraData = {
    nara: {
      label: 'é£›é³¥ãƒ»å¥ˆè‰¯',
      period: '708å¹´ã€œ',
      currencyName: 'æ–‡ï¼ˆã‚‚ã‚“ï¼‰',
      baseRate: 50, // 1æ–‡ â‰ˆ 50~100å††
      description: 'æ—¥æœ¬åˆã®æµé€šè²¨å¹£ã€Œå’ŒåŒé–‹çã€ãŒç™»å ´ã€‚ã—ã‹ã—ä¿¡ç”¨ã¯ä½ãã€éƒ½ï¼ˆã‚­ãƒŠã‚¤ï¼‰ä»¥å¤–ã§ã¯ç±³ã‚„å¸ƒãŒä¸»å½¹ã€‚',
      items: [
        { name: 'ç±³ 2kg', price: 10, icon: 'ğŸŒ¾' },
        { name: 'å¡© 1å‡', price: 2, icon: 'ğŸ§‚' },
        { name: 'å¸ƒ 1å', price: 50, icon: 'ğŸ§µ' },
        { name: 'é‚¸å®…ã®åœŸåœ°', price: 1000, icon: 'ğŸ ' },
      ],
      column: {
        title: 'è“„éŠ­å™ä½ä»¤ã®ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹',
        text: 'æ”¿åºœã¯ã€ŒãŠé‡‘ã‚’è²¯ã‚ãŸã‚‰ä½ã‚’ã‚ã’ã‚‹ã€ã¨è¨€ã„ã¾ã—ãŸãŒã€è£ã‚’è¿”ã›ã°ã€Œãã†ã§ã‚‚ã—ãªã„ã¨èª°ã‚‚ä½¿ã£ã¦ãã‚Œãªã‹ã£ãŸã€ã®ã§ã™ã€‚éŠ…ä¸è¶³ã§éŠ­ã®è³ªãŒæ‚ªããªã‚‹ã¨ã€äººã€…ã¯ã™ãã«ä½¿ã‚ãªããªã‚Šã¾ã—ãŸã€‚'
      }
    },
    heian: {
      label: 'å¹³å®‰æ™‚ä»£',
      period: '10ä¸–ç´€ã€œ',
      currencyName: 'ç±³ãƒ»çµ¹ï¼ˆç‰©å“è²¨å¹£ï¼‰',
      baseRate: 0, // ç‰¹æ®Šå‡¦ç†
      description: 'å…¬çš„ãªè²¨å¹£ç™ºè¡ŒãŒåœæ­¢ï¼ˆæœ¬æœåäºŒéŠ­ã®æœ€å¾Œã€Œéš†å¹³æ°¸å®ã€ä»¥é™ï¼‰ã€‚çµŒæ¸ˆã¯ã€Œç±³ã€ã¨ã€Œçµ¹ã€ã®äº¤æ›ã«æˆ»ã‚‹ã€‚',
      isCommodityMoney: true, // ç‰©å“è²¨å¹£ãƒ•ãƒ©ã‚°
      items: [
        { name: 'é¦¬ 1é ­', price: 500000, display:'ç±³50çŸ³', icon: 'ğŸ' },
        { name: 'è²´æ—ã®è£…æŸ', price: 200000, display:'çµ¹20ç–‹', icon: 'ğŸ‘˜' },
      ],
      column: {
        title: 'è²¨å¹£ã®æ¶ˆå¤±',
        text: 'ã€Œæœ¬æœåäºŒéŠ­ã€ã®è³ªãŒæ‚ªåŒ–ã—ã™ãã¦ä¿¡ç”¨å´©å£Šã€‚äººã€…ã¯è…ã‚‰ãªã„ã€Œå¸ƒã€ã‚„ä¸»é£Ÿã®ã€Œç±³ã€ã‚’ãŠé‡‘ã®ä»£ã‚ã‚Šã«ã—ã¾ã—ãŸã€‚ã“ã‚Œã‚’ç‰©å“è²¨å¹£ã¨ã„ã„ã¾ã™ã€‚'
      }
    },
    medieval: {
      label: 'éŒå€‰ãƒ»å®¤ç”º',
      period: '12ä¸–ç´€ã€œ',
      currencyName: 'æ–‡ï¼ˆæ¸¡æ¥éŠ­ï¼‰',
      baseRate: 100, // å®‹éŠ­ãƒ»æ˜éŠ­ã€‚éœ€è¦ãŒé«˜ãä¾¡å€¤ãŒã‚ã‚‹ã€‚
      description: 'ä¸­å›½ï¼ˆå®‹ãƒ»æ˜ï¼‰ã‹ã‚‰å¤§é‡ã®éŠ­ã‚’è¼¸å…¥ã€‚ã€Œæ°¸æ¥½é€šå®ã€ãªã©ã®æ¸¡æ¥éŠ­ãŒæµé€šã—ã€çµŒæ¸ˆãŒæ´»ç™ºåŒ–ã€‚',
      items: [
        { name: 'å¤ªåˆ€ï¼ˆæ­¦å™¨ï¼‰', price: 1000, icon: 'âš”ï¸' },
        { name: 'æ‰‡å­', price: 50, icon: 'ğŸª­' },
        { name: 'é¦¬å€Ÿã®é‹è³ƒ', price: 20, icon: 'ğŸ´' },
        { name: 'é–¢æ‰€ã®é€šè¡Œæ–™', price: 10, icon: 'ğŸš§' },
      ],
      column: {
        title: 'æ’°éŠ­ï¼ˆãˆã‚Šãœã«ï¼‰ã¨æ’°éŠ­ä»¤',
        text: 'å‰²ã‚ŒãŸã‚Šã™ã‚Šæ¸›ã£ãŸã‚Šã—ãŸã€Œãƒ“ã‚¿éŠ­ï¼ˆæ‚ªéŠ­ï¼‰ã€ã‚’å—ã‘å–ã‚Šæ‹’å¦ã™ã‚‹ã€Œæ’°éŠ­ã€ãŒæ¨ªè¡Œã€‚å¹•åºœã¯ã€Œæ‚ªéŠ­ã‚‚ä¸€å®šå‰²åˆãªã‚‰æ··ãœã¦ä½¿ãˆã€ã¨ã„ã†ç†ä¸å°½ãªå‘½ä»¤ï¼ˆæ’°éŠ­ä»¤ï¼‰ã‚’å‡ºã—ã¾ã—ãŸã€‚'
      }
    },
    azuchi: {
      label: 'å®‰åœŸæ¡ƒå±±',
      period: '16ä¸–ç´€æœ«',
      currencyName: 'ä¸¡ãƒ»çŸ³',
      baseRate: 60000, // 1ä¸¡(å¤§åˆ¤)ã¯éå¸¸ã«é«˜ä¾¡
      description: 'ä¿¡é•·ãƒ»ç§€å‰ã®æ™‚ä»£ã€‚é‡‘éŠ€ã®å¤§åˆ¤ãŒä½œã‚‰ã‚ŒãŸãŒã€æ©è³ç”¨ã§åº¶æ°‘ã«ã¯ç„¡ç¸ã€‚ã€ŒçŸ³é«˜ï¼ˆç±³ã®å–ã‚Œé«˜ï¼‰ã€ãŒåŸºæº–ã€‚',
      items: [
        { name: 'é‰„ç ² 1ä¸', price: 10, display: 'ç´„10ä¸¡', icon: 'ğŸ”«' },
        { name: 'èŒ¶å™¨ï¼ˆåç‰©ï¼‰', price: 1000, display: 'ä¸€å›½ä¸€åŸ', icon: 'ğŸµ' },
        { name: 'å—è›®æ¸¡æ¥ã®æ™‚è¨ˆ', price: 50, display: '50ä¸¡', icon: 'ğŸ•°ï¸' },
      ],
      column: {
        title: 'é‡‘ã®èŒ¶å®¤ã¨æ©è³',
        text: 'ã“ã®æ™‚ä»£ã®é‡‘è²¨ï¼ˆå¤©æ­£å¤§åˆ¤ãªã©ï¼‰ã¯ã€è²·ã„ç‰©ç”¨ã§ã¯ãªãã€Œå®¶æ¥ã¸ã®ã”è¤’ç¾ã€ã§ã—ãŸã€‚ç§€å‰ãŒã°ã‚‰æ’’ã„ãŸé‡‘éŠ€ã¯ã€æ´¾æ‰‹ãªæ¡ƒå±±æ–‡åŒ–ã®è±¡å¾´ã§ã™ã€‚'
      }
    },
    edo_early: {
      label: 'æ±Ÿæˆ¸åˆæœŸ',
      period: 'æ…¶é•·ã€œå¯›æ°¸',
      currencyName: 'ä¸‰è²¨åˆ¶åº¦',
      baseRate: 20, // 1æ–‡ = 20å††ï¼ˆå®‰å®šæœŸï¼‰
      // 1ä¸¡ = 4000æ–‡ = 8~10ä¸‡å††
      description: 'å®¶åº·ã«ã‚ˆã‚Šä¸‰è²¨åˆ¶åº¦ï¼ˆé‡‘ãƒ»éŠ€ãƒ»éŠ­ï¼‰ãŒç¢ºç«‹ã€‚è²¨å¹£ã®è³ªã‚‚è‰¯ãã€çµŒæ¸ˆãŒå®‰å®šã—ã¦ã„ãŸé»„é‡‘æœŸã€‚',
      items: [
        { name: 'ç±³ 10kg', price: 500, icon: 'ğŸŒ¾' },
        { name: 'é…’ 1å‡', price: 200, icon: 'ğŸ¶' },
        { name: 'é£›è„šï¼ˆéƒµä¾¿ï¼‰', price: 300, icon: 'ğŸƒ' },
        { name: 'æœ¨ç¶¿ã®ç€ç‰©', price: 4000, display: '1ä¸¡', icon: 'ğŸ‘˜' },
      ],
      column: {
        title: 'æ…¶é•·å°åˆ¤ã®ä¿¡é ¼',
        text: 'å®¶åº·ãŒä½œã£ãŸã€Œæ…¶é•·å°åˆ¤ã€ã¯é‡‘ã®ç´”åº¦ãŒé«˜ãï¼ˆç´„86%ï¼‰ã€ä¸–ç•Œçš„ã«è¦‹ã¦ã‚‚éå¸¸ã«è‰¯è³ªãªé€šè²¨ã§ã—ãŸã€‚ã“ã‚ŒãŒæ±Ÿæˆ¸260å¹´ã®å¹³å’Œã®åŸºç¤ã¨ãªã‚Šã¾ã—ãŸã€‚'
      }
    },
    edo_genroku: {
      label: 'æ±Ÿæˆ¸ä¸­æœŸ',
      period: 'å…ƒç¦„ã€œå®æ°¸',
      currencyName: 'ä¸‰è²¨ï¼ˆæ”¹é‹³ï¼‰',
      baseRate: 15, // ã‚¤ãƒ³ãƒ•ãƒ¬ç™ºç”Ÿã€‚1æ–‡ã®ä¾¡å€¤ãŒä¸‹ãŒã‚‹ï¼ˆ=ç‰©ä¾¡ãŒä¸ŠãŒã‚‹ï¼‰
      description: 'è»åŸé‡ç§€ã«ã‚ˆã‚‹ã€Œå…ƒç¦„ã®æ”¹é‹³ã€ã€‚é‡‘ã®å«æœ‰é‡ã‚’æ¸›ã‚‰ã—ãŸè²¨å¹£ã‚’å¤§é‡ç™ºè¡Œã—ã€ã‚¤ãƒ³ãƒ•ãƒ¬ã¨å¥½æ™¯æ°—ãŒåˆ°æ¥ã€‚',
      items: [
        { name: 'äº•åŸè¥¿é¶´ã®æœ¬', price: 150, icon: 'ğŸ“–' },
        { name: 'æ­Œèˆä¼ã®æ¡Ÿæ•·å¸­', price: 20000, display:'5ä¸¡', icon: 'ğŸ­' },
        { name: 'é«˜ç´šæ–™äº­ã®é£Ÿäº‹', price: 4000, display:'1ä¸¡', icon: 'ğŸ±' },
        { name: 'èŠ±ç«ã®å¯„ä»˜', price: 1000, icon: 'ğŸ†' },
      ],
      column: {
        title: 'è²¨å¹£ã¯å›½å®¶ã®é“å…·',
        text: 'å‹˜å®šåŸå‘³å½¹ã®è»åŸé‡ç§€ã¯ã€Œè²¨å¹£ã¯å›½å®¶ãŒå®šã‚ã‚‹ã‚‚ã®ã€‚ç“¦ï¼ˆã‹ã‚ã‚‰ï¼‰ã§ã‚ã£ã¦ã‚‚è‰¯ã„ã€ã¨ã„ã†åè¨€ã‚’æ®‹ã—ã€ç®¡ç†é€šè²¨åˆ¶åº¦ã®å…ˆé§†ã‘ã¨ãªã‚‹è€ƒãˆã§å¹•åºœè²¡æ”¿ã‚’é»’å­—ã«ã—ã¾ã—ãŸã€‚'
      }
    },
    edo_late: {
      label: 'å¹•æœ«',
      period: 'ä¸‡å»¶ã€œæ…¶å¿œ',
      currencyName: 'ä¸‰è²¨ï¼ˆå´©å£Šï¼‰',
      baseRate: 4, // è¶…ã‚¤ãƒ³ãƒ•ãƒ¬ã€‚1æ–‡ = 4~5å††
      description: 'é–‹å›½ã«ã‚ˆã‚‹é‡‘ã®æµå‡ºã¨ã€æ”¿æƒ…ä¸å®‰ã«ã‚ˆã‚‹ãƒã‚¤ãƒ‘ãƒ¼ã‚¤ãƒ³ãƒ•ãƒ¬ã€‚ã€Œãˆãˆã˜ã‚ƒãªã„ã‹ã€ã®ç‹‚ä¹±ç‰©ä¾¡ã€‚',
      items: [
        { name: 'åµ 1å€‹', price: 50, icon: 'ğŸ¥š' },
        { name: 'ãã° 1æ¯', price: 200, icon: 'ğŸœ' },
        { name: 'éŒ¦çµµï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼‰', price: 30, icon: 'ğŸ“°' },
        { name: 'è¼¸å…¥ãƒ©ã‚¤ãƒ•ãƒ«', price: 200000, display:'50ä¸¡', icon: 'ğŸ”«' },
      ],
      column: {
        title: 'é‡‘æµå‡ºå•é¡Œ',
        text: 'æ—¥æœ¬ã®é‡‘éŠ€äº¤æ›æ¯”ç‡ï¼ˆ1:5ï¼‰ã¨æµ·å¤–ï¼ˆ1:15ï¼‰ã®é•ã„ã‚’çªã‹ã‚Œã€å¤§é‡ã®å°åˆ¤ãŒæµ·å¤–ã¸æµå‡ºã€‚å¹•åºœã¯å¯¾æŠ—ã—ã¦è³ªã‚’æ¥µç«¯ã«è½ã¨ã—ãŸã€Œä¸‡å»¶å°åˆ¤ã€ã‚’ç™ºè¡Œã—ã€çŒ›çƒˆãªã‚¤ãƒ³ãƒ•ãƒ¬ã‚’æ‹›ãã¾ã—ãŸã€‚'
      }
    },
    meiji_early: {
      label: 'æ˜æ²»åˆæœŸ',
      period: 'ã€œ1880å¹´ä»£',
      currencyName: 'å††',
      baseRate: 1000, // æ··ä¹±æœŸã€‚1å††ã®ä¾¡å€¤ãŒã¾ã å®šã¾ã‚‰ãªã„ã€‚
      description: 'è—©æœ­ã‚„å¤ªæ”¿å®˜æœ­ãŒä¹±ç«‹ã€‚æ–°è²¨æ¡ä¾‹ã§ã€Œå††ã€ãŒã§ãã‚‹ãŒã€è¥¿å—æˆ¦äº‰ã®æˆ¦è²»èª¿é”ã§ä¸æ›ç´™å¹£ãŒå¢—ç™ºã•ã‚Œã‚¤ãƒ³ãƒ•ãƒ¬ã«ã€‚',
      items: [
        { name: 'æ–°è', price: 0.03, display:'3éŠ­', icon: 'ğŸ“°' },
        { name: 'ç‰›é‹', price: 0.15, display:'15éŠ­', icon: 'ğŸ¥˜' },
        { name: 'æ•£é«ª', price: 0.1, display:'10éŠ­', icon: 'ğŸ’ˆ' },
      ],
      column: {
        title: 'ä¸æ›ç´™å¹£ã®ææ€–',
        text: 'é‡‘ã¨äº¤æ›ã§ããªã„ç´™å¹£ï¼ˆä¸æ›ç´™å¹£ï¼‰ã‚’åˆ·ã‚Šã¾ãã£ãŸçµæœã€ç´™å¹£ã®ä¾¡å€¤ãŒæš´è½ã€‚æ”¿åºœã¯å¾Œã«ã€Œæ¾æ–¹è²¡æ”¿ã€ã§è¡€ã‚’æµã™ã‚ˆã†ãªãƒ‡ãƒ•ãƒ¬æ”¿ç­–ã‚’è¡Œã„ã€ã“ã‚Œã‚’æ•´ç†ã—ã¾ã—ãŸã€‚'
      }
    },
    meiji_late: {
      label: 'æ˜æ²»å¾ŒæœŸ',
      period: 'æ—¥æ¸…ãƒ»æ—¥éœ²å¾Œ',
      currencyName: 'å††ï¼ˆé‡‘æœ¬ä½ï¼‰',
      baseRate: 10000, // 1å†† = 1ä¸‡å††ï¼ˆå®‰å®šï¼‰
      description: 'é‡‘æœ¬ä½åˆ¶ç¢ºç«‹ã€‚ç”£æ¥­é©å‘½ãŒé€²ã¿ã€è³‡æœ¬ä¸»ç¾©çµŒæ¸ˆãŒç™ºå±•ã€‚',
      items: [
        { name: 'ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹', price: 0.1, display:'10éŠ­', icon: 'ğŸ›' },
        { name: 'å¸å›½å¤§å­¦æˆæ¥­æ–™', price: 25, display:'25å††', icon: 'ğŸ“' },
        { name: 'å¤ç›®æ¼±çŸ³ã®æœ¬', price: 1, display:'1å††', icon: 'ğŸ“š' },
      ],
      column: {
        title: 'é‡‘æœ¬ä½åˆ¶ã¸ã®é“',
        text: 'æ—¥æ¸…æˆ¦äº‰ã®è³ å„Ÿé‡‘ï¼ˆé‡‘ï¼‰ã‚’æº–å‚™é‡‘ã¨ã—ã¦ã€1897å¹´ã«è²¨å¹£æ³•ã‚’åˆ¶å®šã€‚ã¤ã„ã«æ—¥æœ¬ã‚‚ã€Œé‡‘æœ¬ä½åˆ¶ã€ã®ä»²é–“å…¥ã‚Šã‚’æœãŸã—ã€å›½éš›çš„ãªä¿¡ç”¨ã‚’å¾—ã¾ã—ãŸã€‚'
      }
    },
    taisho: {
      label: 'å¤§æ­£ãƒ»æ˜­å’ŒåˆæœŸ',
      period: '1910-20å¹´ä»£',
      currencyName: 'å††',
      baseRate: 4000, // WWIãƒãƒ–ãƒ«ã§ç‰©ä¾¡ä¸Šæ˜‡
      description: 'å¤§æˆ¦æ™¯æ°—ã§ã€Œæˆé‡‘ã€ãŒç™»å ´ã™ã‚‹ä¸€æ–¹ã€ç±³é¨’å‹•ãªã©ã‚‚ç™ºç”Ÿã€‚ãƒ¢ãƒ€ãƒ³æ–‡åŒ–ãŒèŠ±é–‹ãã€‚',
      items: [
        { name: 'ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«', price: 0.05, display:'5éŠ­', icon: 'ğŸ¬' },
        { name: 'å–«èŒ¶åº—ã®ã‚³ãƒ¼ãƒ’ãƒ¼', price: 0.1, display:'10éŠ­', icon: 'â˜•' },
        { name: 'ã‚¿ã‚¯ã‚·ãƒ¼ï¼ˆå††ã‚¿ã‚¯ï¼‰', price: 1, display:'1å††', icon: 'ğŸš•' },
        { name: 'ãƒ‡ãƒ‘ãƒ¼ãƒˆã®æ´‹æœ', price: 10, display:'10å††', icon: 'ğŸ‘—' },
      ],
      column: {
        title: 'æˆé‡‘ã¨ã‚·ãƒ™ãƒªã‚¢å‡ºå…µ',
        text: 'ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ¦ã§æ—¥æœ¬ã¯è¼¸å‡ºã§å¤§å„²ã‘ã—ã€Œèˆ¹æˆé‡‘ã€ãŒç¶šå‡ºã€‚ã—ã‹ã—æ€¥æ¿€ãªã‚¤ãƒ³ãƒ•ãƒ¬ã§ç±³ã®å€¤æ®µãŒä¸ŠãŒã‚Šã€1918å¹´ã«ã¯ã€Œç±³é¨’å‹•ã€ãŒèµ·ã“ã‚Šã¾ã—ãŸã€‚'
      }
    }
  };

  const calculateConversion = () => {
    const era = eraData[selectedEra];
    if (era.isCommodityMoney) return null; // ç‰©å“è²¨å¹£ã®å ´åˆã¯è¨ˆç®—ãªã—

    let rate = era.baseRate;
    return currentYen / rate;
  };

  const formatCurrency = (value) => {
    if (value === null) return "æ›ç®—ä¸èƒ½";
    if (selectedEra === 'nara' || selectedEra === 'medieval' || selectedEra === 'edo_genroku' || selectedEra === 'edo_late') {
       return `${Math.floor(value).toLocaleString()} æ–‡`;
    }
    
    // æ±Ÿæˆ¸åˆæœŸã®é‡‘éŠ€è¨ˆç®—
    if (selectedEra === 'edo_early') {
      if (region === 'edo') {
        const ryo = Math.floor(value / 4000);
        const remainder = value % 4000;
        const bu = Math.floor(remainder / 1000);
        const shu = Math.floor((remainder % 1000) / 250);
        const mon = Math.floor(remainder % 250);
        let res = [];
        if(ryo) res.push(`${ryo}ä¸¡`);
        if(bu) res.push(`${bu}åˆ†`);
        if(shu) res.push(`${shu}æœ±`);
        if(mon || res.length===0) res.push(`${mon}æ–‡`);
        return res.join(' ');
      } else {
        const totalMomme = value * 0.015; // ç°¡æ˜“æ›ç®—
        const kan = Math.floor(totalMomme / 1000);
        const momme = Math.floor(totalMomme % 1000);
        return `${kan ? kan+'è²« ' : ''}${momme}åŒ`;
      }
    }

    if (selectedEra === 'azuchi') {
        // å¤§åˆ¤ãƒ»å°åˆ¤ãƒ™ãƒ¼ã‚¹ï¼ˆéå¸¸ã«å¤§é›‘æŠŠï¼‰
        const ryo = value; // baseRateãŒé«˜ã„ãŸã‚ã€valueã¯ä¸¡å˜ä½ã«è¿‘ã„
        return `ç´„ ${ryo.toFixed(2)} ä¸¡`;
    }

    // æ˜æ²»ä»¥é™
    if (['meiji_early', 'meiji_late', 'taisho'].includes(selectedEra)) {
      const yen = Math.floor(value);
      const sen = Math.floor((value * 100) % 100);
      return `${yen}å†† ${sen}éŠ­`;
    }

    return `${Math.floor(value)}`;
  };

  const convertedValue = calculateConversion();

  return (
    <div className="min-h-screen bg-stone-100 font-sans text-stone-800 p-4 md:p-8">
      <div className="max-w-5xl mx-auto">
        
        {/* Header */}
        <header className="mb-8 text-center bg-amber-900 text-amber-50 rounded-2xl p-6 shadow-xl">
          <h1 className="text-2xl md:text-4xl font-bold mb-2 flex items-center justify-center gap-3">
            <History className="w-8 h-8 md:w-10 md:h-10" />
            æ—¥æœ¬å² è²¨å¹£ãƒ»ç‰©ä¾¡ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ«
          </h1>
          <p className="opacity-90">ç¾ä»£ã®1ä¸‡å††ã‚’æ¡ã‚Šã—ã‚ã¦ã€æ¿€å‹•ã®æ­´å²ã¸é£›ã³è¾¼ã‚‚ã†</p>
        </header>

        {/* Controls */}
        <div className="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6 sticky top-0 z-10 border-b-4 border-amber-200">
          <div className="flex flex-col md:flex-row gap-6 items-center justify-between">
            <div className="flex items-center gap-3 w-full md:w-auto">
              <label className="font-bold text-stone-600 whitespace-nowrap">æ‰€æŒé‡‘ï¼š</label>
              <div className="relative w-full">
                <input
                  type="number"
                  value={currentYen}
                  onChange={(e) => setCurrentYen(Math.max(0, parseInt(e.target.value) || 0))}
                  className="text-xl md:text-2xl font-bold p-2 border-2 border-stone-200 rounded-lg w-full md:w-48 text-right pr-10 focus:outline-none focus:border-amber-500 transition-colors"
                />
                <span className="absolute right-3 top-3.5 text-stone-400 font-bold">å††</span>
              </div>
            </div>

            <div className="flex items-center gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 scrollbar-hide">
               <select 
                 value={selectedEra}
                 onChange={(e) => setSelectedEra(e.target.value)}
                 className="bg-amber-100 font-bold text-amber-900 text-lg p-3 rounded-lg border-2 border-amber-300 focus:outline-none cursor-pointer w-full md:w-auto"
               >
                 {Object.entries(eraData).map(([key, data]) => (
                   <option key={key} value={key}>
                     {data.label} ({data.period})
                   </option>
                 ))}
               </select>
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="grid lg:grid-cols-3 gap-6">
          
          {/* Left: Calculation & Items */}
          <div className="lg:col-span-2 space-y-6">
            
            {/* Currency Card */}
            <div className="bg-gradient-to-br from-amber-50 to-white rounded-2xl border-2 border-amber-200 p-6 shadow-md relative overflow-hidden transition-all duration-300">
              <div className="absolute top-0 right-0 p-4 opacity-5">
                <Coins className="w-40 h-40" />
              </div>

              <div className="flex justify-between items-start mb-4">
                <div>
                  <h2 className="text-2xl font-bold text-amber-900 flex items-center gap-2">
                    {eraData[selectedEra].label}
                  </h2>
                  <p className="text-amber-700 text-sm font-bold mt-1">{eraData[selectedEra].description}</p>
                </div>
                {/* Edo Toggle */}
                {selectedEra === 'edo_early' && (
                  <div className="flex bg-white rounded-lg border border-amber-200 p-1">
                    <button onClick={() => setRegion('edo')} className={`px-3 py-1 rounded text-sm font-bold ${region === 'edo' ? 'bg-amber-500 text-white' : 'text-stone-500'}`}>æ±ï¼ˆé‡‘ï¼‰</button>
                    <button onClick={() => setRegion('osaka')} className={`px-3 py-1 rounded text-sm font-bold ${region === 'osaka' ? 'bg-stone-500 text-white' : 'text-stone-500'}`}>è¥¿ï¼ˆéŠ€ï¼‰</button>
                  </div>
                )}
              </div>

              <div className="text-center py-6">
                <div className="text-sm text-stone-500 mb-1">ç¾åœ¨ã® {currentYen.toLocaleString()} å††ã¯...</div>
                <div className="text-4xl md:text-5xl font-extrabold text-amber-800 break-words leading-tight">
                  {eraData[selectedEra].isCommodityMoney ? (
                     <span className="text-2xl text-stone-500">è²¨å¹£ä¾¡å€¤æ›ç®—ã§ãã¾ã›ã‚“<br/>(ç±³ã‚„å¸ƒãŒé€šè²¨ä»£ã‚ã‚Š)</span>
                  ) : formatCurrency(convertedValue)}
                </div>
              </div>

              {/* Status Tags */}
              <div className="flex gap-2 mt-4 justify-center">
                {['edo_genroku', 'edo_late', 'meiji_early', 'taisho'].includes(selectedEra) && (
                   <span className="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                     <TrendingUp className="w-3 h-3" /> ã‚¤ãƒ³ãƒ•ãƒ¬æœŸ
                   </span>
                )}
                {['meiji_late'].includes(selectedEra) && (
                   <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                     <TrendingDown className="w-3 h-3" /> ãƒ‡ãƒ•ãƒ¬ãƒ»å®‰å®šæœŸ
                   </span>
                )}
                {['medieval'].includes(selectedEra) && (
                   <span className="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                     <AlertTriangle className="w-3 h-3" /> æ’°éŠ­ãƒˆãƒ©ãƒ–ãƒ«å¤šç™º
                   </span>
                )}
              </div>
            </div>

            {/* Shopping List */}
            <div className="bg-white rounded-2xl shadow-sm border border-stone-200 p-6">
              <h3 className="font-bold text-stone-700 mb-4 flex items-center gap-2">
                <ShoppingBag className="w-5 h-5 text-amber-600" />
                å½“æ™‚ã®è²·ãˆã‚‹ã‚‚ã®ãƒªã‚¹ãƒˆ
              </h3>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {eraData[selectedEra].items.map((item, idx) => {
                  let canBuy = 0;
                  if (!eraData[selectedEra].isCommodityMoney) {
                      // ç°¡æ˜“è¨ˆç®—ï¼šitem.priceã¯ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ¼ãƒˆæ›ç®—å¾Œã®å˜ä½ï¼ˆæ–‡ã‚„éŠ­ï¼‰ã«è¿‘ã„å€¤ã§è¨­å®š
                      // ãŸã ã—Azuchiã‚„Meijiãªã©ã¯ç‰¹æ®Š
                      let itemCostInBase = item.price; // æ–‡ or éŠ­ or ä¸¡
                      
                      // æ™‚ä»£ã”ã¨ã®æ‰€æŒé‡‘ï¼ˆconvertedValueï¼‰ã¨ã®æ¯”è¼ƒ
                      // â€»ç°¡ç•¥åŒ–ã®ãŸã‚ã€convertedValueã¨åŒã˜å˜ä½ç³»ã§itemsã®priceã‚’è¨­å®šã—ã¦ã„ã‚‹å‰æ
                      canBuy = Math.floor(convertedValue / item.price);
                      
                      // ä¸¡å˜ä½ã®ä¿®æ­£ï¼ˆAzuchiï¼‰
                      if(selectedEra === 'azuchi') canBuy = Math.floor(currentYen / (eraData.azuchi.baseRate * item.price));
                  } else {
                      // ç‰©å“è²¨å¹£ï¼ˆå¹³å®‰ï¼‰ï¼šå††ã‹ã‚‰ç›´æ¥è¨ˆç®—
                      // é¦¬(50ä¸‡)
                      canBuy = Math.floor(currentYen / item.price);
                  }

                  return (
                    <div key={idx} className={`flex items-center justify-between p-3 rounded-xl border ${canBuy > 0 ? 'bg-amber-50 border-amber-200' : 'bg-stone-50 border-stone-100 opacity-60'}`}>
                       <div className="flex items-center gap-3">
                         <div className="text-2xl w-10 text-center">{item.icon}</div>
                         <div>
                           <div className="font-bold text-stone-800">{item.name}</div>
                           <div className="text-xs text-stone-500">
                             å‚è€ƒä¾¡æ ¼: {item.display || `${item.price}${eraData[selectedEra].currencyName}`}
                           </div>
                         </div>
                       </div>
                       <div className="text-right">
                         <div className="text-lg font-bold text-stone-700">
                           {canBuy > 0 ? canBuy.toLocaleString() : '0'} 
                           <span className="text-xs font-normal ml-1">å€‹</span>
                         </div>
                       </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Right: History Column */}
          <div className="space-y-6">
            <div className="bg-stone-800 text-stone-100 rounded-2xl p-6 shadow-xl border-t-4 border-amber-500">
              <div className="flex items-center gap-2 mb-4 text-amber-400">
                <BookOpen className="w-6 h-6" />
                <h3 className="font-bold text-lg">æ­´å²ã®ãƒˆãƒ¬ãƒ“ã‚¢</h3>
              </div>
              <h4 className="font-bold text-white text-xl mb-2">{eraData[selectedEra].column.title}</h4>
              <p className="text-stone-300 text-sm leading-relaxed">
                {eraData[selectedEra].column.text}
              </p>
            </div>

            {/* Era Timeline Guide (Simple) */}
            <div className="bg-white rounded-2xl p-6 border border-stone-200">
              <h3 className="font-bold text-stone-700 mb-3 text-sm">æ™‚ä»£ã®æµã‚Œ</h3>
              <div className="relative pl-4 border-l-2 border-stone-200 space-y-4">
                 <div className={`text-sm ${['nara','heian'].includes(selectedEra) ? 'font-bold text-amber-600' : 'text-stone-400'}`}>å¤ä»£ï¼šå›½ç”£ã®æŒ«æŠ˜ã¨ç‰©å“è²¨å¹£</div>
                 <div className={`text-sm ${['medieval'].includes(selectedEra) ? 'font-bold text-amber-600' : 'text-stone-400'}`}>ä¸­ä¸–ï¼šæ¸¡æ¥éŠ­ã®æµå…¥</div>
                 <div className={`text-sm ${selectedEra.includes('edo') || selectedEra === 'azuchi' ? 'font-bold text-amber-600' : 'text-stone-400'}`}>è¿‘ä¸–ï¼šä¸‰è²¨åˆ¶åº¦ã®ç¢ºç«‹ã¨æ”¹é‹³</div>
                 <div className={`text-sm ${selectedEra.includes('meiji') || selectedEra === 'taisho' ? 'font-bold text-amber-600' : 'text-stone-400'}`}>è¿‘ä»£ï¼šå††ã®çµ±ä¸€ã¨é‡‘æœ¬ä½åˆ¶</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
};

export default App;
